services:

  gateway:
    build: 
      context: .
      dockerfile: dockerfile.gateway  
    container_name: web-gateway
    volumes:
    #   - ./web_porxy_nginx:/var/www/dashboard    
      - ./web_proxy_nginx:/usr/share/nginx/html # üëà Map ‡πÑ‡∏ü‡∏•‡πå HTML
      - ./web_proxy_nginx/nginx.conf:/etc/nginx/nginx.conf # üëà Map Config Nginx
    ports:
      - "8080:8080"
    depends_on:
      - auth-service         

  auth-service:
    image: node:18-alpine  # ‡πÉ‡∏ä‡πâ Image Node ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏£‡∏π‡∏õ ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á install ‡πÄ‡∏≠‡∏á
    container_name: auth-service
    working_dir: /app
    volumes:
      # ‚úÖ ‡πÉ‡∏ä‡πâ Volume ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö Nginx ‡πÄ‡∏•‡∏¢ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå users.json ‡∏ï‡∏±‡∏ß‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡πÑ‡∏î‡πâ
      - ./web_proxy_node:/app 
    command: sh -c "npm install express body-parser cors express-session mongoose && node server.js"
    ports:
      - "3000:3000"
    restart: always
    depends_on:
      - mongo # ‡∏ö‡∏≠‡∏Å‡πÉ‡∏´‡πâ‡∏£‡∏≠ mongo ‡∏£‡∏±‡∏ô‡∏Å‡πà‡∏≠‡∏ô (‡∏£‡∏∞‡∏î‡∏±‡∏ö network)

  mongo:
    image: mongo:latest
    container_name: mongodb
    restart: always
    ports:
      - "27017:27017"
    volumes:
      - ./web_proxy_mongo:/data/db  # Map ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡∏Ç‡πâ‡∏≤‡∏á‡∏ô‡∏≠‡∏Å ‡∏Å‡∏±‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏≤‡∏¢

# ---------------------------------------------------------------------------------------------------------



  jupyter:
    build:
      context: ./
      dockerfile: dockerfile.jupyter
    container_name: jupyter
    ports:
      - "8888:8888"          
    volumes:
      - ./work_space:/home/master

  pipelines:
      ports:
          - 9099:9099
      extra_hosts:
          - host.docker.internal:host-gateway
      volumes:
          - ./pipelines:/app/pipelines
      container_name: pipelines
      restart: always
      image: ghcr.io/open-webui/pipelines:main
    #   environment:
    #     - PIPELINES_API_KEY=0p3n-w3bu!

  open-webui:
      container_name: open-webui
      restart: always
      image: ghcr.io/open-webui/open-webui:main
      ports:
          - 8877:8080
      volumes:
          - ./open-webui:/app/backend/data  # 
      environment:
          - OLLAMA_BASE_URL=http://ollama:11434      
          # - WEBUI_URL=http://localhost:8080/open-webui
          - OPENAI_API_BASE_URL=http://pipelines:9099
          - ENABLE_CODE_EXECUTION=true  


# -------------------------------------------------------------------------------------------------

  White_board:
    image: lovasoa/wbo:latest
    container_name: White_board
    ports:
      - "5001:80" # ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ú‡πà‡∏≤‡∏ô http://localhost:5001
    volumes:
      - ./work_space/web_white_board:/opt/app/server-data # ‡πÄ‡∏ã‡∏ü‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô‡πÑ‡∏ß‡πâ
    restart: unless-stopped

  obsidian:
    image: lscr.io/linuxserver/obsidian:latest
    container_name: obsidian
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Asia/Bangkok
    volumes:
      - ./work_space/web_obsidian-config:/config  # ‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ü‡∏•‡πå Vault ‡πÅ‡∏•‡∏∞ Config ‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
    ports:
      - 3400:3000  # ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ú‡πà‡∏≤‡∏ô http://localhost:3000
      - 3401:3001  # HTTPS
    # ‡∏™‡∏≠‡∏á‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏•‡πà‡∏≤‡∏á‡∏ô‡∏µ‡πâ ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Obsidian (‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏°‡∏±‡∏ô‡πÄ‡∏õ‡πá‡∏ô Electron App)
    security_opt:
      - seccomp:unconfined 
    shm_size: "1gb"
    restart: unless-stopped

#   webtop:
#     image: lscr.io/linuxserver/webtop:ubuntu-xfce
#     container_name: webtop
#     security_opt:
#       - seccomp:unconfined # ‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ö‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå
#     environment:
#       - PUID=1000 # User ID
#       - PGID=1000 # Group ID
#       - TZ=Asia/Bangkok # ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏ó‡∏¢
#       - SUBFOLDER=/ # (Optional) ‡∏ñ‡πâ‡∏≤‡πÉ‡∏ä‡πâ Reverse Proxy
#       # - KEYBOARD=en-us-qwerty # (Optional) ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏µ‡∏¢‡πå‡∏ö‡∏≠‡∏£‡πå‡∏î
#     volumes:
#       - ./work_space/web_desktop:/config # ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Home Directory ‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏≤‡∏¢
#       # - /var/run/docker.sock:/var/run/docker.sock # (Optional) ‡πÄ‡∏õ‡∏¥‡∏î‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏≤‡∏Å‡∏£‡∏±‡∏ô Docker ‡∏ã‡πâ‡∏≠‡∏ô‡∏Ç‡πâ‡∏≤‡∏á‡πÉ‡∏ô
#     ports:
#       - 3100:3000 # ‡∏û‡∏≠‡∏£‡πå‡∏ï‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏ú‡πà‡∏≤‡∏ô HTTP
#       - 3101:3001 # ‡∏û‡∏≠‡∏£‡πå‡∏ï‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏ú‡πà‡∏≤‡∏ô HTTPS
#     shm_size: "1gb" # ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å! ‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏á‡∏±‡πâ‡∏ô Browser ‡πÉ‡∏ô Webtop ‡∏à‡∏∞‡πÅ‡∏Ñ‡∏£‡∏ä‡∏ö‡πà‡∏≠‡∏¢
#     restart: unless-stopped
 

volumes:
    open-webui:
        external: true
        name: open-webui
    pipelines:
        external: true
        name: pipelines     
    # ollama:
    #     external: true
    #     name: ollama

# docker volume create --name=pipelines
# docker volume create --name=open-webui